/*! Node-Chat 07-05-2014 */
function updateContainer(){$(window).height();$(".chatLog").animate({height:$(window).height()-125},1e3),$("#chatLog").scrollTop($("#chatLog")[0].scrollHeight)}function checkInput(){var a=document.getElementById("chatBox").value;"/nick"==a.substr(0,5)&&(document.getElementById("chatBox").value=a.substr(0,25))}function saveNick(){document.getElementById("chatBox").value="/nick "+document.getElementById("newNick").value,sendMessage(),$("#changeNick").foundation("reveal","close")}function makeFancy(a){for(var b=a;-1!==b.indexOf("*");){var c=b.indexOf("*"),d=b.indexOf("*",c+1);if(-1!==d){var e=b.substring(c+1,d),f="<strong>"+e+"</strong>";b=b.substring(0,c)+f+b.substring(d+1,b.length)}else b=b.replace("*","")}return b}function chat(a,b){var c,d=moment().format("HH:mm:ss");a==lastUser&&15>lastUserMsgCount?(lastUserMsgCount++,c=""):(c=a,lastUserMsgCount=1),""!==c&&(c="&lt;"+c+"&gt;"),lastUser=a,"&lt;SERVER&gt;"==c&&(c='<span class="serverMessage">'+c+"</span>"),b=makeFancy(b),$("#chatLog").append('     <div class="row">       <div class="large-1 columns show-for-large-up">         <div class="chatTime full-height">'+d+'</div>       </div>       <div class="small-4 medium-2 large-2 columns right-seperator">          <div class="chatName full-height">'+c+'</div>       </div>       <div class="small-8 medium-10 large-9 columns">         <div class="chatMessage full-height">'+b+"</div>       </div>     </div>     "),"SERVER"!=a&&notify(a+": "+b.replace(/(<([^>]+)>)/gi,""),!1);var e=$(".chatMessage").last().height();if($(".chatName").last().css({height:e}),$(".chatTime").last().css({height:e}),$("#chatLog").scrollTop($("#chatLog")[0].scrollHeight),!isActive){var f=new Audio("sounds/alert.mp3");playSound(f),document.title="New Message!",b.toLowerCase().indexOf($(nickname).html().toLowerCase())>-1&&(setTimeout(function(){playSound(f)},6),document.title="You have been mentioned!","SERVER"!=a&&notify("You have been mentioned by "+a+"!",!1))}}function clearLog(){$("#chatLog").html(""),lastUser="",lastUserMsgCount=0}function updateUsers(a){var b="";b+="<li><label>Users</label></li>";for(var c in a)b+='<li><a href="#">'+a[c]+"</a></li>";document.getElementById("usersList").innerHTML=b}function sendMessage(){socket.socket.connected||"/connect"!=document.getElementById("chatBox").value.trim()||socket.socket.connect(),""!==document.getElementById("chatBox").value.trim()?($("#chatBox").removeClass("error"),"/clear"==document.getElementById("chatBox").value.trim()?clearLog():socket.emit("broadcast",{message:""+document.getElementById("chatBox").value}),document.getElementById("chatBox").value=""):$("#chatBox").hasClass("error")||$("#chatBox").addClass("error")}function updateName(a){$(nickname).html(a.name)}function rememberNick(){void 0!==$.cookie("nick")&&(document.getElementById("chatBox").value="/nick "+$.cookie("nick"),sendMessage())}function reverseEscapeHtml(a){return String(a).replace(/&amp;|&lt;|&gt;|&quot;|&#39;|&#x2F;/g,function(a){return reverseEntityMap[a]})}function notify(a,b){!b&&isActive||Notify.needsPermission()||new Notify("HardOrange Chat",{body:reverseEscapeHtml(a),icon:"images/hardorange_small.png",timeout:10}).show()}function needPermission(){$("#enableNotifications").html("Enable Desktop Notifications"),$("#enableNotifications").click(function(){Notify.requestPermission(),noNeedPermission()})}function noNeedPermission(){$("#enableNotifications").html("Desktop Notifications Enabled"),$("#enableNotifications").click(function(){notify("Notifications can be disabled in your browser's settings.",!0)})}function playSound(a){sounds&&a.play()}$(document).foundation();var users=[],socket=io.connect("http://"+ip),isActive=!0,modalOpen=!1,sounds=!1,lastUser="",lastUserMsgCount=0;$(document).ready(function(){updateContainer(),$(window).resize(function(){updateContainer()})}),$("#chatLog").click(function(){$("#chatBox").focus()}),window.onfocus=function(){isActive=!0,document.title="HardOrange Chat"},window.onblur=function(){isActive=!1},$(document).on("opened","[data-reveal]",function(){document.getElementById("newNick").focus(),modalOpen=!0}),$(document).on("closed","[data-reveal]",function(){modalOpen=!1}),$("#saveNick").click(function(){$.cookie("nick",$(nickname).html()),notify("Nick saved!",!0)}),socket.on("connect",function(){console.log("connect"),rememberNick()}),socket.on("broadcast",function(a){chat(a.client,a.message)}),socket.on("annouce",function(a){chat("SERVER",a.message)}),socket.on("users",function(a){updateUsers(a)}),socket.on("name",function(a){updateName(a)}),socket.on("disconnect",function(){chat("SERVER",'<span class="serverMessage">You have disconnected. Type /connect to reconnect.</span>'),updateUsers([]),setTimeout(function(){location.reload()},1e3)}),$(document).keydown(function(a){13==a.which&&(modalOpen?saveNick():sendMessage())});var reverseEntityMap={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#x2F;":"/"};Notify.isSupported()?Notify.needsPermission()?needPermission():noNeedPermission():$("#enableNotifications").html("No Browser Notification Support"),$("#toggleSounds").click(function(){if(sounds)sounds=!1,$("#toggleSounds").html("Enable Message Sounds");else{sounds=!0,$("#toggleSounds").html("Disable Message Sounds");var a=new Audio("sounds/alert.mp3");playSound(a)}});var swipeleft=Hammer(document.body).on("swiperight",function(){$(".off-canvas-wrap").addClass("move-right")}),swiperight=Hammer(document.body).on("swipeleft",function(){$(".off-canvas-wrap").addClass("move-left")});